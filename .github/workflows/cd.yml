name: CD

on:
    workflow_run:
        workflows: ["CI"]
        types: ["completed"]
        branches: ["master"]

jobs:
    deploy:
        if: ${{ github.event.workflow_run.conclusion == 'success' }}
        runs-on: ubuntu-latest
        
        steps:
            - name: Download build artifact
              uses: actions/download-artifact@v4
              with:
                name: dist
                path: dist

            - name: Install Netlify CLI
              run: npm install -g netlify-cli

            - name: Deploy to Netlify
              env:
                NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
                NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}
              run: |
                netlify deploy \
                --dir=dist \
                --site=$NETLIFY_SITE_ID \
                --auth=$NETLIFY_AUTH_TOKEN \
                --prod